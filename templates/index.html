<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PhD research design for SQL injection attack by Nwabudike Augustine</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            margin-bottom: 30px;
            color: white;
            animation: fadeInDown 1s ease-out;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .logo-container {
            flex-shrink: 0;
        }

        .logo {
            width: 120px;
            height: 120px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            background: white;
            padding: 10px;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            font-weight: bold;
            color: #333;
        }

        .logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 5px;
        }

        .logo-fallback {
            text-align: center;
            font-size: 14px;
            line-height: 1.2;
        }

        .header-text {
            flex: 1;
            min-width: 300px;
        }

        .header h1 {
            font-size: clamp(1.3rem, 3.5vw, 2.2rem);
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            line-height: 1.2;
        }

        .header p {
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            opacity: 0.9;
        }

        .model-status {
            background: rgba(255,255,255,0.1);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            color: white;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            font-size: clamp(0.8rem, 2vw, 1rem);
        }

        .model-status.loading {
            background: rgba(255,193,7,0.2);
        }

        .model-status.ready {
            background: rgba(40,167,69,0.2);
        }

        .model-status.error {
            background: rgba(220,53,69,0.2);
        }

        .main-content {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            width: 100%;
        }

        .page {
            display: none;
            width: 100%;
            max-width: 900px;
            animation: fadeIn 0.5s ease-in;
        }

        .page.active {
            display: block;
        }

        .home-page {
            text-align: center;
        }

        .button-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
            justify-content: center;
            margin-top: 30px;
            align-items: center;
        }

        .main-button {
            color: white;
            border: none;
            padding: clamp(20px, 4vw, 25px) clamp(30px, 6vw, 40px);
            font-size: clamp(1rem, 3vw, 1.3rem);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 350px;
            position: relative;
            overflow: hidden;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .main-button.detection {
            background: linear-gradient(145deg, #4CAF50, #45a049);
        }

        .main-button.prevention {
            background: linear-gradient(145deg, #FF6B6B, #ee5a52);
        }

        .main-button:hover:not(:disabled) {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }

        .main-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .button-subtitle {
            font-size: 0.9rem; 
            margin-top: 8px; 
            opacity: 0.9;
            font-weight: normal;
        }

        .detection-page, .prevention-page {
            background: rgba(255,255,255,0.95);
            border-radius: 20px;
            padding: clamp(20px, 4vw, 40px);
            box-shadow: 0 20px 60px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin: 10px;
        }

        .page-title {
            text-align: center;
            margin-bottom: 25px;
            color: #333;
            font-size: clamp(1.5rem, 4vw, 2rem);
        }

        .model-info {
            background: #f8f9fa;
            padding: clamp(10px, 3vw, 15px);
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            color: #495057;
            word-break: break-word;
        }

        .input-section {
            margin-bottom: 25px;
        }

        .input-section label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
            color: #555;
            font-size: clamp(0.9rem, 2.5vw, 1rem);
        }

        .query-input {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: clamp(0.9rem, 2.5vw, 1rem);
            font-family: 'Courier New', monospace;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .query-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.2);
        }

        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 25px;
        }

        .action-button {
            background: linear-gradient(145deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: clamp(12px, 3vw, 15px) clamp(20px, 4vw, 30px);
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: clamp(100px, 25vw, 120px);
            flex: 1;
            max-width: 150px;
        }

        .action-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(33, 150, 243, 0.3);
        }

        .action-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .action-button.back {
            background: linear-gradient(145deg, #9E9E9E, #757575);
        }

        .action-button.clear {
            background: linear-gradient(145deg, #FF9800, #F57C00);
        }

        .result-section {
            margin-top: 25px;
            padding: 15px;
            border-radius: 10px;
            min-height: 80px;
            display: none;
            animation: slideUp 0.5s ease-out;
        }

        .result-section.show {
            display: block;
        }

        .result-safe {
            background: linear-gradient(145deg, #E8F5E8, #C8E6C9);
            border: 2px solid #4CAF50;
            color: #2E7D32;
        }

        .result-malicious {
            background: linear-gradient(145deg, #FFE8E8, #FFCDD2);
            border: 2px solid #F44336;
            color: #C62828;
        }

        .result-icon {
            font-size: clamp(1.5rem, 4vw, 2rem);
            margin-bottom: 8px;
        }

        .result-text {
            font-size: clamp(1rem, 3vw, 1.2rem);
            font-weight: bold;
            margin-bottom: 8px;
        }

        .result-details {
            font-size: clamp(0.8rem, 2.2vw, 0.95rem);
            margin-top: 8px;
        }

        .prediction-details {
            background: rgba(255,255,255,0.7);
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }

        .confidence-bar {
            width: 100%;
            height: 16px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 8px 0;
        }

        .confidence-fill {
            height: 100%;
            transition: width 0.5s ease-in-out;
            border-radius: 10px;
        }

        .confidence-safe {
            background: linear-gradient(90deg, #28a745, #20c997);
        }

        .confidence-malicious {
            background: linear-gradient(90deg, #dc3545, #e74c3c);
        }

        .recommendations {
            margin-top: 12px;
            padding: 12px;
            background: rgba(255,255,255,0.8);
            border-radius: 8px;
        }

        .recommendations h4 {
            margin-bottom: 8px;
            color: #333;
            font-size: clamp(0.9rem, 2.5vw, 1rem);
        }

        .recommendations ul {
            list-style: none;
            padding: 0;
        }

        .recommendations li {
            padding: 4px 0;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            font-size: clamp(0.8rem, 2.2vw, 0.9rem);
        }

        .recommendations li:last-child {
            border-bottom: none;
        }

        .no-data-message {
            background: linear-gradient(145deg, #FFF8E1, #FFECB3);
            border: 2px solid #FFA000;
            color: #E65100;
            padding: 20px;
            border-radius: 12px;
            margin-top: 15px;
            text-align: center;
            font-size: clamp(1rem, 3vw, 1.2rem);
            font-weight: bold;
            animation: slideUp 0.5s ease-out;
        }

        .sample-queries {
            background: rgba(240, 248, 255, 0.8);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .sample-queries h3 {
            color: #333;
            margin-bottom: 12px;
            text-align: center;
            font-size: clamp(1rem, 3vw, 1.2rem);
        }

        .sample-query {
            background: #f8f9fa;
            padding: 8px;
            margin: 6px 0;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: clamp(0.8rem, 2vw, 0.9rem);
            cursor: pointer;
            transition: background-color 0.3s ease;
            border-left: 4px solid #007bff;
            word-break: break-all;
            line-height: 1.3;
        }

        .sample-query:hover {
            background: #e9ecef;
        }

        .sample-query.malicious {
            border-left-color: #dc3545;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 15px;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #f5c6cb;
            font-size: clamp(0.8rem, 2.2vw, 0.9rem);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .header-text {
                min-width: auto;
            }

            .logo {
                width: 100px;
                height: 100px;
            }
        }

        @media (min-width: 480px) {
            .button-container {
                flex-direction: row;
                flex-wrap: wrap;
            }
            
            .main-button {
                flex: 1;
                min-width: 280px;
                max-width: none;
            }
        }

        @media (min-width: 769px) {
            .header-content {
                text-align: left;
            }

            .container {
                padding: 20px;
            }
            
            .button-container {
                flex-direction: row;
                gap: 30px;
            }
            
            .main-button {
                max-width: 350px;
            }
            
            .detection-page, .prevention-page {
                margin: 0;
            }
            
            .button-group {
                gap: 15px;
            }
            
            .action-button {
                flex: 0 1 auto;
                max-width: 200px;
            }
        }

        @media (min-width: 1024px) {
            .logo {
                width: 140px;
                height: 140px;
            }
            
            .query-input {
                min-height: 120px;
            }
        }

        @media (max-width: 320px) {
            .container {
                padding: 10px;
            }
            
            .detection-page, .prevention-page {
                padding: 15px;
                margin: 5px;
            }
            
            .button-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .action-button {
                max-width: none;
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-content">
                <div class="logo-container">
                    <div class="logo">
                        <img src="{{ url_for('static', filename='upmlogo.jpg') }}" alt="UPM Logo">
                    </div>
                </div>
                <div class="header-text">
                    <h1>PhD Research Design for SQL Injection Attack Detection & Prevention</h1>
                    <p>By Nwabudike Augustine - Universiti Putra Malaysia</p>
                </div>
            </div>
        </header>

        <div id="modelStatus" class="model-status loading">
            <div>🔄 Loading trained models and tokenizers...</div>
        </div>

        <main class="main-content">
            <!-- Home Page -->
            <div id="homePage" class="page active home-page">
                <div class="button-container">
                    <button id="detectionBtn" class="main-button detection" onclick="showPage('detectionPage')" disabled>
                        🔍 SQL Attack Detection
                        <div class="button-subtitle">
                            Using trained CNN + BiLSTM model
                        </div>
                    </button>
                    <button id="preventionBtn" class="main-button prevention" onclick="showPage('preventionPage')" disabled>
                        🛡️ SQL Attack Prevention
                        <div class="button-subtitle">
                            ML-powered validation & recommendations
                        </div>
                    </button>
                </div>
            </div>

            <!-- Detection Page -->
            <div id="detectionPage" class="page detection-page">
                <h2 class="page-title">🔍 SQL Injection Detection</h2>
                
                <div class="model-info" id="detectionModelInfo">
                    <strong>Model:</strong> Loading... | <strong>Status:</strong> Initializing...
                </div>

                <div class="input-section">
                    <label for="detectionQuery">Enter SQL Query for Analysis:</label>
                    <textarea id="detectionQuery" class="query-input" 
                        placeholder="Example: SELECT * FROM users WHERE id = 1 OR 1=1 --"></textarea>
                </div>

                <div class="button-group">
                    <button class="action-button" onclick="analyzeQuery('detection')" id="detectBtn" disabled>Detect</button>
                    <button class="action-button clear" onclick="clearQuery('detectionQuery')">🗑️ Clear</button>
                    <button class="action-button back" onclick="showPage('homePage')">← Back</button>
                </div>

                <div class="loading" id="detectionLoading">
                    <div class="spinner"></div>
                    <p>Model analyzing query patterns...</p>
                </div>

                <div id="detectionResult" class="result-section">
                    <div class="result-icon" id="detectionIcon"></div>
                    <div class="result-text" id="detectionText"></div>
                    <div class="result-details" id="detectionDetails"></div>
                    <div class="prediction-details">
                        <div><strong>Model Confidence:</strong></div>
                        <div class="confidence-bar">
                            <div id="detectionConfidenceBar" class="confidence-fill" style="width: 0%"></div>
                        </div>
                        <div id="detectionConfidenceText">0%</div>
                    </div>
                </div>

                <div class="sample-queries">
                    <h3>📝 Sample Queries from Training Dataset</h3>
                    <div id="detectionSamples">Loading samples...</div>
                </div>
            </div>

            <!-- Prevention Page -->
            <div id="preventionPage" class="page prevention-page">
                <h2 class="page-title">🛡️ SQL Attack Prevention</h2>
                
                <div class="model-info" id="preventionModelInfo">
                    <strong>Model:</strong> Loading... | <strong>Mode:</strong> Prevention & Validation
                </div>

                <div class="input-section">
                    <label for="preventionQuery">Enter SQL Query for Security Validation:</label>
                    <textarea id="preventionQuery" class="query-input" 
                        placeholder="Example: SELECT * FROM products WHERE category = 'electronics'"></textarea>
                </div>

                <div class="button-group">
                    <button class="action-button" onclick="analyzeQuery('prevention')" id="preventBtn" disabled>🛡️ Validate & Secure</button>
                    <button class="action-button clear" onclick="clearQuery('preventionQuery')">🗑️ Clear</button>
                    <button class="action-button back" onclick="showPage('homePage')">← Back</button>
                </div>

                <div class="loading" id="preventionLoading">
                    <div class="spinner"></div>
                    <p>Analyzing query security and generating recommendations...</p>
                </div>

                <div id="preventionResult" class="result-section">
                    <div class="result-icon" id="preventionIcon"></div>
                    <div class="result-text" id="preventionText"></div>
                    <div class="result-details" id="preventionDetails"></div>
                    <div class="prediction-details">
                        <div><strong>Security Score:</strong></div>
                        <div class="confidence-bar">
                            <div id="preventionConfidenceBar" class="confidence-fill" style="width: 0%"></div>
                        </div>
                        <div id="preventionConfidenceText">0%</div>
                    </div>
                    <div class="recommendations" id="preventionRecommendations" style="display: none;">
                        <h4>🔒 Security Recommendations:</h4>
                        <ul id="recommendationsList"></ul>
                    </div>
                </div>

                <!-- No Data Message for unsafe queries -->
                <div id="noDataMessage" class="no-data-message" style="display: none;">
                    🚫 No data record to show
                    <div style="font-size: 0.9rem; margin-top: 8px; font-weight: normal;">
                        Query blocked due to potential security risks
                    </div>
                </div>

                <div class="sample-queries">
                    <h3>📝 Sample Queries for Testing</h3>
                    <div id="preventionSamples">Loading samples...</div>
                </div>
            </div>
        </main>
    </div>

    <script>
        let modelsLoaded = false;
        let sampleQueries = { safe: [], malicious: [] };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Application initializing...');
            initializeApplication();
        });

        function initializeApplication() {
            checkModelStatus();
            loadSampleQueries();
            setupTextareaAutoResize();
            setupInteractiveEffects();
            setupViewportHandling();
        }

        // Check model status from backend
        async function checkModelStatus() {
            try {
                // Simulate API call - replace with actual endpoint
                // const response = await fetch('/api/status');
                // const data = await response.json();
                
                // Mock data for demonstration
                const data = {
                    models_loaded: true,
                    detection_available: true,
                    prevention_available: true,
                    detection_config: {
                        model_type: 'CNN+BiLSTM',
                        best_threshold: 0.5,
                        classes: ['Normal', 'SQLi'],
                        version: '1.0'
                    },
                    prevention_config: {
                        model_type: 'CNN+BiLSTM Enhanced',
                        version: '1.0'
                    }
                };
                
                const statusElement = document.getElementById('modelStatus');
                const detectionBtn = document.getElementById('detectionBtn');
                const preventionBtn = document.getElementById('preventionBtn');
                const detectBtn = document.getElementById('detectBtn');
                const preventBtn = document.getElementById('preventBtn');
                
                if (data.models_loaded) {
                    statusElement.className = 'model-status ready';
                    statusElement.innerHTML = `
                        <div>✅ Models loaded successfully!</div>
                        <div style="font-size: 0.9rem; margin-top: 5px;">
                            Detection: ${data.detection_available ? 'Ready' : 'N/A'} | 
                            Prevention: ${data.prevention_available ? 'Ready' : 'Using Detection Model'}
                        </div>
                    `;
                    
                    // Enable buttons
                    detectionBtn.disabled = false;
                    preventionBtn.disabled = false;
                    if (detectBtn) detectBtn.disabled = false;
                    if (preventBtn) preventBtn.disabled = false;
                    modelsLoaded = true;
                    
                    // Update model info sections
                    updateModelInfo(data);
                } else {
                    statusElement.className = 'model-status error';
                    statusElement.innerHTML = '❌ Failed to load models. Please check model files.';
                }
            } catch (error) {
                console.error('Error checking model status:', error);
                // For demo purposes, simulate successful loading after delay
                setTimeout(() => simulateModelLoading(), 2000);
            }
        }

        function simulateModelLoading() {
            const statusElement = document.getElementById('modelStatus');
            const detectionBtn = document.getElementById('detectionBtn');
            const preventionBtn = document.getElementById('preventionBtn');
            const detectBtn = document.getElementById('detectBtn');
            const preventBtn = document.getElementById('preventBtn');

            statusElement.className = 'model-status ready';
            statusElement.innerHTML = `
                <div>✅ Models loaded successfully! (Demo Mode)</div>
                <div style="font-size: 0.9rem; margin-top: 5px;">
                    Detection: Ready | Prevention: Ready
                </div>
            `;
            
            detectionBtn.disabled = false;
            preventionBtn.disabled = false;
            if (detectBtn) detectBtn.disabled = false;
            if (preventBtn) preventBtn.disabled = false;
            modelsLoaded = true;

            // Update model info
            updateModelInfo({
                detection_config: {
                    model_type: 'CNN+BiLSTM',
                    best_threshold: 0.5,
                    classes: ['Normal', 'SQLi'],
                    version: '1.0'
                },
                prevention_config: {
                    model_type: 'CNN+BiLSTM Enhanced',
                    version: '1.0'
                }
            });
        }

        function updateModelInfo(data) {
            const detectionInfo = document.getElementById('detectionModelInfo');
            if (data.detection_config) {
                detectionInfo.innerHTML = `
                    <strong>Model:</strong> ${data.detection_config.model_type || 'CNN+BiLSTM'} | 
                    <strong>Threshold:</strong> ${data.detection_config.best_threshold || 0.5} | 
                    <strong>Classes:</strong> ${data.detection_config.classes ? data.detection_config.classes.join(' / ') : 'Normal / SQLi'} |
                    <strong>Version:</strong> ${data.detection_config.version || '1.0'}
                `;
            }
            
            const preventionInfo = document.getElementById('preventionModelInfo');
            if (data.prevention_config) {
                preventionInfo.innerHTML = `
                    <strong>Model:</strong> ${data.prevention_config.model_type || 'CNN+BiLSTM'} | 
                    <strong>Mode:</strong> Prevention & Validation |
                    <strong>Version:</strong> ${data.prevention_config.version || '1.0'}
                `;
            } else {
                preventionInfo.innerHTML = `
                    <strong>Model:</strong> Detection Model (Dual Mode) | 
                    <strong>Mode:</strong> Prevention & Validation |
                    <strong>Status:</strong> Using Detection Model for Prevention
                `;
            }
        }

        async function loadSampleQueries() {
            try {
                // Simulate loading sample queries
                sampleQueries = {
                    safe: [
                        "SELECT * FROM users WHERE id = 1",
                        "SELECT name, email FROM customers WHERE status = 'active'",
                        "INSERT INTO products (name, price) VALUES ('Laptop', 999.99)",
                        "UPDATE users SET last_login = NOW() WHERE id = 123",
                        "SELECT COUNT(*) FROM orders WHERE date >= '2024-01-01'"
                    ],
                    malicious: [
                        "SELECT * FROM users WHERE id = 1 OR 1=1 --",
                        "SELECT * FROM users WHERE name = 'admin'/**/AND/**/password/**/=/**/'password'",
                        "SELECT * FROM users WHERE id = 1 UNION SELECT username, password FROM admin",
                        "SELECT * FROM users WHERE id = 1'; DROP TABLE users; --",
                        "SELECT * FROM users WHERE id = 1 AND (SELECT COUNT(*) FROM admin) > 0",
                        "SELECT * FROM users WHERE id = 1 OR 'x'='x'",
                        "SELECT * FROM users WHERE id = 1 AND SLEEP(10)",
                        "SELECT * FROM users WHERE id = 1 OR BENCHMARK(1000000,MD5(1))"
                    ]
                };
                
                // Update detection samples
                updateSampleQueries('detectionSamples', [...sampleQueries.safe.slice(0, 3), ...sampleQueries.malicious.slice(0, 5)], 'detectionQuery');
                
                // Update prevention samples
                updateSampleQueries('preventionSamples', [...sampleQueries.safe.slice(0, 3), ...sampleQueries.malicious.slice(0, 3)], 'preventionQuery');
                
            } catch (error) {
                console.error('Error loading sample queries:', error);
            }
        }

        function updateSampleQueries(containerId, queries, targetInputId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            queries.forEach(query => {
                const div = document.createElement('div');
                div.className = sampleQueries.malicious.includes(query) ? 'sample-query malicious' : 'sample-query';
                div.textContent = query;
                div.onclick = () => fillQuery(targetInputId, query);
                container.appendChild(div);
            });
        }

        function setupTextareaAutoResize() {
            const textareas = document.querySelectorAll('.query-input');
            textareas.forEach(textarea => {
                textarea.addEventListener('input', function() {
                    this.style.height = 'auto';
                    this.style.height = Math.max(100, this.scrollHeight) + 'px';
                });
            });
        }

        function showPage(pageId) {
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                page.classList.remove('active');
            });

            // Show selected page
            document.getElementById(pageId).classList.add('active');

            // Clear any previous results
            const resultSections = document.querySelectorAll('.result-section');
            resultSections.forEach(section => {
                section.classList.remove('show');
            });

            // Hide no data message
            const noDataMessage = document.getElementById('noDataMessage');
            if (noDataMessage) {
                noDataMessage.style.display = 'none';
            }
        }

        function fillQuery(inputId, query) {
            document.getElementById(inputId).value = query.trim();
            // Auto-resize textarea
            const textarea = document.getElementById(inputId);
            textarea.style.height = 'auto';
            textarea.style.height = Math.max(100, textarea.scrollHeight) + 'px';
        }

        function clearQuery(inputId) {
            document.getElementById(inputId).value = '';
            document.getElementById(inputId).style.height = '100px';
            
            // Hide results
            const resultSection = inputId.includes('detection') ? 'detectionResult' : 'preventionResult';
            document.getElementById(resultSection).classList.remove('show');
            
            // Hide no data message
            const noDataMessage = document.getElementById('noDataMessage');
            if (noDataMessage) {
                noDataMessage.style.display = 'none';
            }
        }

        async function analyzeQuery(type) {
            if (!modelsLoaded) {
                alert('Models are not loaded yet. Please wait...');
                return;
            }

            const inputId = type + 'Query';
            const loadingId = type + 'Loading';
            const resultId = type + 'Result';
            
            const query = document.getElementById(inputId).value.trim();

            if (!query) {
                alert('Please enter a SQL query to analyze.');
                return;
            }

            // Show loading
            document.getElementById(loadingId).classList.add('show');
            document.getElementById(resultId).classList.remove('show');
            
            // Hide no data message
            const noDataMessage = document.getElementById('noDataMessage');
            if (noDataMessage) {
                noDataMessage.style.display = 'none';
            }

            try {
                // Simulate API call with mock analysis
                const result = await simulateAnalysis(query, type);
                displayResults(result, type);

            } catch (error) {
                console.error('Analysis error:', error);
                displayError(error.message, type);
            } finally {
                // Hide loading
                document.getElementById(loadingId).classList.remove('show');
                document.getElementById(resultId).classList.add('show');
            }
        }

        async function simulateAnalysis(query, type) {
            // Simulate processing delay
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            const queryLower = query.toLowerCase();
            
            // Simple heuristic detection
            const maliciousPatterns = [
                'or 1=1', 'union select', 'drop table', '-- ', '/*', '*/',
                'or \'x\'=\'x\'', 'and \'x\'=\'x\'', 'sleep(', 'benchmark(',
                'information_schema', 'sysobjects', 'msysobjects', 'waitfor'
            ];
            
            const isMalicious = maliciousPatterns.some(pattern => queryLower.includes(pattern));
            const confidence = isMalicious ? Math.random() * 0.3 + 0.7 : Math.random() * 0.4 + 0.6; // 70-100% for malicious, 60-100% for safe
            
            if (type === 'detection') {
                return {
                    is_malicious: isMalicious,
                    confidence: confidence * 100,
                    prediction_class: isMalicious ? 'SQLi' : 'Normal',
                    probability: isMalicious ? confidence : 1 - confidence,
                    threshold: 0.5,
                    model_info: {
                        name: 'SQL Injection Detector',
                        type: 'CNN+BiLSTM'
                    }
                };
            } else {
                // Prevention mode
                const safetyScore = isMalicious ? Math.random() * 0.3 + 0.1 : Math.random() * 0.3 + 0.7;
                const recommendations = generateRecommendations(query, isMalicious);
                
                return {
                    is_safe: !isMalicious,
                    prevention_score: safetyScore * 100,
                    risk_level: isMalicious ? 'HIGH' : 'LOW',
                    safety_probability: safetyScore,
                    malicious_probability: 1 - safetyScore,
                    recommendations: recommendations,
                    model_info: {
                        name: 'SQL Security Validator',
                        type: 'CNN+BiLSTM Enhanced'
                    }
                };
            }
        }

        function generateRecommendations(query, isMalicious) {
            const recommendations = [];
            
            if (isMalicious) {
                recommendations.push("🚨 Query contains potential SQL injection patterns");
                recommendations.push("🔒 Use parameterized queries/prepared statements");
                recommendations.push("🛡️ Implement input validation and sanitization");
                recommendations.push("⚠️ Consider using stored procedures for complex queries");
                recommendations.push("🔍 Enable SQL injection detection in your WAF");
            } else {
                recommendations.push("✅ Query structure appears safe");
                recommendations.push("💡 Consider using parameterized queries for better security");
                recommendations.push("🔒 Implement proper access controls");
                recommendations.push("📊 Monitor query execution patterns");
                recommendations.push("🧪 Regular security testing recommended");
            }
            
            return recommendations;
        }

        function displayResults(result, type) {
            if (type === 'detection') {
                displayDetectionResults(result);
            } else {
                displayPreventionResults(result);
            }
        }

        function displayDetectionResults(result) {
            const resultSection = document.getElementById('detectionResult');
            const icon = document.getElementById('detectionIcon');
            const text = document.getElementById('detectionText');
            const details = document.getElementById('detectionDetails');
            const confidenceBar = document.getElementById('detectionConfidenceBar');
            const confidenceText = document.getElementById('detectionConfidenceText');

            // Update classes
            resultSection.classList.remove('result-safe', 'result-malicious');
            if (result.is_malicious) {
                resultSection.classList.add('result-malicious');
                icon.textContent = '⚠️';
                confidenceBar.className = 'confidence-fill confidence-malicious';
            } else {
                resultSection.classList.add('result-safe');
                icon.textContent = '✅';
                confidenceBar.className = 'confidence-fill confidence-safe';
            }

            // Update content
            text.textContent = result.is_malicious ? 
                '🚨 SQL INJECTION DETECTED!' : 
                '✅ Query appears safe';

            const confidence = Math.round(result.confidence);
            details.innerHTML = `
                <p><strong>Prediction:</strong> ${result.prediction_class}</p>
                <p><strong>Probability:</strong> ${result.probability.toFixed(4)}</p>
                <p><strong>Threshold:</strong> ${result.threshold}</p>
                <p><strong>Model:</strong> ${result.model_info.name} (${result.model_info.type})</p>
            `;

            // Update confidence bar
            confidenceBar.style.width = confidence + '%';
            confidenceText.textContent = `${confidence}% confidence`;
        }

        function displayPreventionResults(result) {
            const resultSection = document.getElementById('preventionResult');
            const icon = document.getElementById('preventionIcon');
            const text = document.getElementById('preventionText');
            const details = document.getElementById('preventionDetails');
            const confidenceBar = document.getElementById('preventionConfidenceBar');
            const confidenceText = document.getElementById('preventionConfidenceText');
            const recommendations = document.getElementById('preventionRecommendations');
            const recommendationsList = document.getElementById('recommendationsList');
            const noDataMessage = document.getElementById('noDataMessage');

            // Handle unsafe queries
            if (!result.is_safe && result.risk_level === 'HIGH') {
                resultSection.style.display = 'none';
                noDataMessage.style.display = 'block';
                return;
            }

            // Show normal results
            resultSection.style.display = 'block';
            noDataMessage.style.display = 'none';

            // Update classes based on safety
            resultSection.classList.remove('result-safe', 'result-malicious');
            if (result.is_safe) {
                resultSection.classList.add('result-safe');
                icon.textContent = '🛡️';
                confidenceBar.className = 'confidence-fill confidence-safe';
            } else {
                resultSection.classList.add('result-malicious');
                icon.textContent = '⚠️';
                confidenceBar.className = 'confidence-fill confidence-malicious';
            }

            // Update content
            text.textContent = result.is_safe ? 
                '✅ Query validated - Security recommendations provided' : 
                '⚠️ Security risks detected - Review recommendations';

            const preventionScore = Math.round(result.prevention_score);
            details.innerHTML = `
                <p><strong>Risk Level:</strong> ${result.risk_level}</p>
                <p><strong>Safety Probability:</strong> ${(result.safety_probability * 100).toFixed(1)}%</p>
                <p><strong>Threat Probability:</strong> ${(result.malicious_probability * 100).toFixed(1)}%</p>
                <p><strong>Model:</strong> ${result.model_info.name}</p>
            `;

            // Update security score bar
            confidenceBar.style.width = preventionScore + '%';
            confidenceText.textContent = `${preventionScore}% security score`;

            // Display recommendations
            if (result.recommendations && result.recommendations.length > 0) {
                recommendations.style.display = 'block';
                recommendationsList.innerHTML = '';
                result.recommendations.forEach(rec => {
                    const li = document.createElement('li');
                    li.textContent = rec;
                    recommendationsList.appendChild(li);
                });
            } else {
                recommendations.style.display = 'none';
            }
        }

        function displayError(message, type) {
            const resultSection = document.getElementById(type + 'Result');
            const icon = document.getElementById(type + 'Icon');
            const text = document.getElementById(type + 'Text');
            const details = document.getElementById(type + 'Details');

            resultSection.classList.remove('result-safe', 'result-malicious');
            resultSection.classList.add('result-malicious');
            
            icon.textContent = '❌';
            text.textContent = 'Analysis Error';
            details.innerHTML = `<div class="error-message">Error: ${message}</div>`;
        }

        function setupInteractiveEffects() {
            // Add hover effects to buttons
            const buttons = document.querySelectorAll('button');
            buttons.forEach(button => {
                button.addEventListener('mouseenter', function() {
                    if (!this.disabled) {
                        this.style.transform = 'translateY(-2px)';
                    }
                });
                
                button.addEventListener('mouseleave', function() {
                    this.style.transform = 'translateY(0)';
                });
            });
        }

        function setupViewportHandling() {
            // Handle orientation changes
            window.addEventListener('orientationchange', function() {
                setTimeout(function() {
                    // Force a reflow to handle orientation changes properly
                    document.body.style.height = 'auto';
                }, 100);
            });

            // Handle viewport changes for mobile browsers
            function handleViewportChange() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
            }

            handleViewportChange();
            window.addEventListener('resize', handleViewportChange);
        }

        // Utility functions
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Export functions for global access (if needed)
        window.sqlInjectionApp = {
            showPage,
            fillQuery,
            clearQuery,
            analyzeQuery
        };

        console.log('SQL Injection Detection & Prevention System loaded successfully!');
    </script>
</body>
</html>